<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Gateway</title>
    <link href="https://unpkg.com/tailwindcss/dist/tailwind.min.css" rel="stylesheet" />
    <!--Replace with your tailwind.css once created-->
    <link href="https://unpkg.com/@tailwindcss/custom-forms/dist/custom-forms.min.css" rel="stylesheet" />

</head>

<body>
    <!-- <button id="rzp-button1" style="padding: 10px; border-radius:5px; margin:10px; color:sandybrown">Pay</button> -->
    <section class="text-gray-600 body-font">
       
        <div class="container px-5 py-24 mx-auto">
          <div class="lg:w-2/3 flex flex-col sm:flex-row sm:items-center items-start mx-auto">
            <h1 class="flex-grow sm:pr-16 text-2xl font-medium title-font text-gray-900">Your Order will be registered with {{user_details["email"]}}. You can check order status through app also.</h1>
            <button  id="rzp-button1" class="flex-shrink-0 text-white bg-yellow-500 border-0 py-2 px-8 focus:outline-none hover:bg-yellow-600 rounded text-lg mt-10 sm:mt-0">Proceed Payment</button>
          </div>
        </div>
      </section>
    <!-- <p>{{user_details}}</p> -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        var options = {
            "key": "rzp_test_AJKHfMYpz8OXtU", // Enter the Key ID generated from the Dashboard
            "amount": "{{payment['amount']}}", // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
            "currency": "INR",
            "name": "StackX",
            "description": "Astrodrishti",
            "image": "https://stackx1617.herokuapp.com/static/images/StackX.png",
            "order_id": "{{payment['id']}}", //This is a sample Order ID. Pass the `id` obtained in the response of Step 2
            
            "handler": function (response) { 
                $.ajax({
                    url:"/astrodrishti/order/success",
                    type:'POST',                   
                    success: function(res)
                    {
                        $.post( "/astrodrishti/order/success", {                   
                            details: "{{user_details|safe}}",
                            payid:response.razorpay_payment_id,    
                            oid:response.razorpay_order_id,                       
                        });
                    },
                    error:function(re)
                    {
                        alert("no no");
                    }
                });

                //alert(response.razorpay_payment_id);
                //alert(response.razorpay_order_id);
                //alert(response.razorpay_signature)

            },
            "theme": {
                "color": "#203D92"
            }
        };
        var rzp1 = new Razorpay(options);
        rzp1.on('payment.failed', function (response) {
            alert("Payment Failed");            
        });
        document.getElementById('rzp-button1').onclick = function (e) {
            rzp1.open();
            e.preventDefault();
        }
    </script>
</body>

</html>